<!DOCTYPE html>
<html>
<head>
<script src="http://autobahn.s3.amazonaws.com/js/autobahn.min.js"></script>
<script src="http://www.chartjs.org/assets/Chart.min.js"></script>

<script>
</script>
</head>
<body>
<h1>Live Interaction with OMNET++ simulation</h1>
<br />
<canvas id="updating-chart" width="500" height="300"></canvas>

<script id="jsbin-javascript">
// WAMP session object
var sess;
var wsuri = "ws://127.0.0.1:9002";

function connect() {
    // connect to WAMP server
    ab.connect(wsuri,

        // WAMP session was established
        function (session) {
            sess = session;
            console.log("Connected to " + wsuri);

            sess.subscribe("http://example.com/simple/ev4", onEvent);
        },

        // WAMP session is gone
        function (code, reason) {
            sess = null;
            console.log("Connection lost (" + reason + ")");
            connected = false;
        },
        {
            'maxRetries': 600,
            'retryDelay': 10
        }
    );

}

window.onload = connect;

var canvas = document.getElementById('updating-chart');
var ctx = canvas.getContext('2d');
var startingData = {
        labels: [],
        datasets: [
        {
           fillColor: "rgba(220,220,220,0.2)",
           strokeColor: "rgba(220,220,220,1)",
           pointColor: "rgba(220,220,220,1)",
           pointStrokeColor: "#fff",
           data: []
        }
        ]
    };
var latestLabel = 1;

var myLiveChart = new Chart(ctx).Line(startingData, {animationSteps: 4});

//var cnt = 0;
//var sum = 0;
//var maxcnt = 20;

function onEvent(topic, event) {
//    sum = sum + parseFloat(event);
//    cnt++;
//    if(cnt == maxcnt) {
//        myLiveChart.addData([sum/maxcnt], ++latestLabel);
//        cnt = 0;
//        sum = 0;
//    }

    // myLiveChart.removeData();
    
    var val = parseFloat(event);
    if(!(val >= 0 && val <= 1)) {
    	val = 0;
    }
    
   	myLiveChart.addData([val], ++latestLabel);
}


</script>
</body>
</html>
